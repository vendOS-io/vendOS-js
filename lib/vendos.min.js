/*
 * @license
 * vendOS v0.0.1
 * (c) 2020 Social Vend Ltd. trading as vendOS
 * Released under the MIT license
 * vendos.io
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("wolfy87-eventemitter")):"function"==typeof define&&define.amd?define(["wolfy87-eventemitter"],t):(e=e||self).vendOS=t(e.EventEmitter)}(this,(function(e){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;const t="background: #021019; color: #03FFCF; padding: 5px 10px; border-radius: 2px",s="background: #021019; color: #D44242; padding: 5px 10px; border-radius: 2px",n=e=>{console&&console.info&&console.info(`%cVendOS SDK: ${e}`,t)};const o=new class extends e{constructor(){super(),this.socketAttempts=0,window.__VENDOS_DEVTOOLS_EXTENSION__?this.connectToDevtools():this.connect()}send(e){this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify(e))}message(e){const t=JSON.parse(e||null);if(t){const{id:e}=t;void 0===e?this.emit("machineEvent",t):this.emit(`message.${t.id}`,(s=["id"],n=t,Object.keys(n).filter(e=>!s.includes(e)).reduce((e,t)=>({...e,[t]:n[t]}),{})))}var s,n}open(){this.socket.onclose=this.close.bind(),this.flushQueue()}close(){var e;e="FieldCommand WebSocket closed",console&&console.info&&console.info(`%cVendOS SDK: ${e}`,s),this.socketAttempts=0,this.reconnect()}reconnect(){this.socketAttempts++,5-this.socketAttempts>0?setTimeout(()=>this.connect(),100):this.failed()}connect(){n("Attempting to connect to FieldCommand WebSocket"),this.socket=new WebSocket("ws://fieldcommand:3000"),this.socket.onclose=this.reconnect.bind(this),this.socket.onopen=this.open.bind(this),this.socket.onmessage=this.message.bind(this)}connectToDevtools(){n("Connecting to vendOS DevTools");const e=window.__VENDOS_DEVTOOLS_EXTENSION__;this.socket={readyState:WebSocket.OPEN,send:t=>e.send(JSON.parse(t))},e.listen(e=>this.message(JSON.stringify(e)))}failed(){n("Could not connect to a Machine websocket. If you'd like to test vendOS JS, please use the vendOS Chrome Dev Tools.")}};let r=0;class c extends e{async send(e){const t=r++;return o.send({...e,id:t}),this.receive(t)}receive(e){return new Promise(t=>o.once(`message.${e}`,t))}}class i extends c{async send(...e){return super.send({resource:"social",...e})}}class d extends i{async send(...e){return super.send({action:"instagram",...e})}friendshipStatus({username:e}){return this.send({method:"friendshipStatus",username:e})}}class a extends i{async send(...e){return super.send({action:"twitter",...e})}searchPosts({username:e,hashtag:t}){return this.send({method:"searchPosts",username:e,hashtag:t})}}class h extends c{async send(e){return super.send({resource:"data",...e})}}class u extends h{async send(e){return super.send({action:"local",...e})}createSet(e){return this.send({method:"createSet",...e})}deleteSet(e){return this.send({method:"deleteSet",...e})}save(e){return this.send({method:"save",...e})}update(e){return this.send({method:"update",...e})}delete(e){return this.send({method:"delete",...e})}}class l extends c{async send(e){return super.send({resource:"machine",...e})}}class m extends l{async send(e){return super.send({action:"vend",...e})}random(e){return this.send({method:"random",...e})}channel(e){return this.send({method:"channel",...e})}optimal(e){return this.send({method:"optimal",...e})}}class p extends l{async send(e){return super.send({action:"channels",...e})}get(){return this.send({method:"get"})}}class f extends c{async send(e){return super.send({resource:"payment",...e})}}class S extends f{async send(e){return super.send({action:"charge",...e})}instant(e){return this.send({method:"instant",...e})}withConfirmation(e){return this.send({method:"withConfirmation",...e})}confirm(e){return this.send({method:"confirm",...e})}cancel(){return this.send({method:"cancel"})}}-1===navigator.userAgent.indexOf("Chrome")&&console.error("It is highly recommended that you develop vendOS in Chrome v.77+.");return class{constructor(){this.Machine={vend:new m,channels:new p},this.Social={twitter:new a,instagram:new d},this.Data={local:new u},this.Payment={charge:new S}}}}));
