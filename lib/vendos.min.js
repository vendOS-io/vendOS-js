/*
 * vendOS v1.0.4
 * (c) 2019 Social Vend Ltd. trading as vendOS 
 * Released under the MIT license
 * vendos.io
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).vendOS=t()}(this,(function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var t=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(t){!function(e){function n(){}var s=n.prototype,r=e.EventEmitter;function i(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function o(e){return function(){return this[e].apply(this,arguments)}}s.getListeners=function(e){var t,n,s=this._getEvents();if(e instanceof RegExp)for(n in t={},s)s.hasOwnProperty(n)&&e.test(n)&&(t[n]=s[n]);else t=s[e]||(s[e]=[]);return t},s.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},s.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&((t={})[e]=n),t||n},s.addListener=function(e,t){if(!function e(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&e(t.listener)}(t))throw new TypeError("listener must be a function");var n,s=this.getListenersAsObject(e),r="object"==typeof t;for(n in s)s.hasOwnProperty(n)&&-1===i(s[n],t)&&s[n].push(r?t:{listener:t,once:!1});return this},s.on=o("addListener"),s.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},s.once=o("addOnceListener"),s.defineEvent=function(e){return this.getListeners(e),this},s.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},s.removeListener=function(e,t){var n,s,r=this.getListenersAsObject(e);for(s in r)r.hasOwnProperty(s)&&-1!==(n=i(r[s],t))&&r[s].splice(n,1);return this},s.off=o("removeListener"),s.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},s.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},s.manipulateListeners=function(e,t,n){var s,r,i=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(s=n.length;s--;)i.call(this,t,n[s]);else for(s in t)t.hasOwnProperty(s)&&(r=t[s])&&("function"==typeof r?i.call(this,s,r):o.call(this,s,r));return this},s.removeEvent=function(e){var t,n=typeof e,s=this._getEvents();if("string"===n)delete s[e];else if(e instanceof RegExp)for(t in s)s.hasOwnProperty(t)&&e.test(t)&&delete s[t];else delete this._events;return this},s.removeAllListeners=o("removeEvent"),s.emitEvent=function(e,t){var n,s,r,i,o=this.getListenersAsObject(e);for(i in o)if(o.hasOwnProperty(i))for(n=o[i].slice(0),r=0;r<n.length;r++)!0===(s=n[r]).once&&this.removeListener(e,s.listener),s.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,s.listener);return this},s.trigger=o("emitEvent"),s.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},s.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},s._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},s._getEvents=function(){return this._events||(this._events={})},n.noConflict=function(){return e.EventEmitter=r,n},t.exports?t.exports=n:e.EventEmitter=n}("undefined"!=typeof window?window:e||{})})),n=(t.named,{vend:{channelVend:{success:!0},optimalVend:{success:!0},randomVend:{success:!0}}});const s=new t;-1==navigator.userAgent.indexOf("Chrome")&&console.error("It is highly recommended that you develop vendOS in Chrome v.77+.");const r=new WebSocket("ws://fieldcommand:3000");let i=!1;r.onmessage=e=>{const t=JSON.parse(e.data);"machine"==t.type&&null==t.id?s.emit("machineEvent",t):s.emit(`message.${t.id}`,t)},r.onerror=e=>{i=!0,console.log("%cPlease ignore the above WebSocket error - Its happening because you are running vendOS locally, no error will occur in production! \nAs vendOS is running in development mode, all promises resolve with a success after 5 seconds. \nHave fun making some cool apps! ðŸ¤™","padding: 10px 0; color:#00c76b; font-size:15px")};const o=e=>new Promise(t=>setTimeout(t,e));let a=0;class c extends t{constructor(){super(),this.machineEvents()}machineEvents(){s.on("machineEvent",e=>{this.emit("event",e)})}async send(e){if(i)return a++,e.id=a,await o(5e3),n[e.type][e.action];if(r.readyState===WebSocket.OPEN){return a++,e.id=a,r.send(JSON.stringify(e)),await this.receive(e.id)}return await o(500),this.send(e)}receive(e){return new Promise(t=>s.once(`message.${e}`,t))}}class u extends c{constructor(){super()}async vend(e,t){try{const n=await this.send({type:"machine",action:e,...t});if(n.ok)return n;throw n}catch(e){throw e}}channels(){return this.send({type:"machine",action:"channels"})}status(){return this.send({type:"machine",action:"status"})}randomVend(e){return this.vend("randomVend",e)}channelVend(e){return this.vend("channelVend",e)}optimalVend(e){return this.vend("optimalVend",e)}}class h extends c{constructor(){super()}friendshipStatus(e){return this.send({type:"instagram",action:"friendshipStatus",username:e})}}class d extends c{constructor(){super()}searchPosts(e,t){return this.send({type:"twitter",action:"searchPosts",username:e,hashtag:t})}}class f extends c{constructor(){super()}save(e){return this.send({type:"data",action:"set",save:e})}}return class{constructor(){this.Machine=new u,this.Instagram=new h,this.Data=new f,this.Twitter=new d}}}));