/*
 * vendOS v1.0.3
 * (c) 2019 Social Vend Ltd. trading as vendOS 
 * Released under the MIT license
 * vendos.io
 */

!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).vendOS=n()}(this,(function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var n=function(e,n){return e(n={exports:{}},n.exports),n.exports}((function(n){!function(e){function t(){}var r=t.prototype,i=e.EventEmitter;function s(e,n){for(var t=e.length;t--;)if(e[t].listener===n)return t;return-1}function o(e){return function(){return this[e].apply(this,arguments)}}r.getListeners=function(e){var n,t,r=this._getEvents();if(e instanceof RegExp)for(t in n={},r)r.hasOwnProperty(t)&&e.test(t)&&(n[t]=r[t]);else n=r[e]||(r[e]=[]);return n},r.flattenListeners=function(e){var n,t=[];for(n=0;n<e.length;n+=1)t.push(e[n].listener);return t},r.getListenersAsObject=function(e){var n,t=this.getListeners(e);return t instanceof Array&&((n={})[e]=t),n||t},r.addListener=function(e,n){if(!function e(n){return"function"==typeof n||n instanceof RegExp||!(!n||"object"!=typeof n)&&e(n.listener)}(n))throw new TypeError("listener must be a function");var t,r=this.getListenersAsObject(e),i="object"==typeof n;for(t in r)r.hasOwnProperty(t)&&-1===s(r[t],n)&&r[t].push(i?n:{listener:n,once:!1});return this},r.on=o("addListener"),r.addOnceListener=function(e,n){return this.addListener(e,{listener:n,once:!0})},r.once=o("addOnceListener"),r.defineEvent=function(e){return this.getListeners(e),this},r.defineEvents=function(e){for(var n=0;n<e.length;n+=1)this.defineEvent(e[n]);return this},r.removeListener=function(e,n){var t,r,i=this.getListenersAsObject(e);for(r in i)i.hasOwnProperty(r)&&-1!==(t=s(i[r],n))&&i[r].splice(t,1);return this},r.off=o("removeListener"),r.addListeners=function(e,n){return this.manipulateListeners(!1,e,n)},r.removeListeners=function(e,n){return this.manipulateListeners(!0,e,n)},r.manipulateListeners=function(e,n,t){var r,i,s=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof n||n instanceof RegExp)for(r=t.length;r--;)s.call(this,n,t[r]);else for(r in n)n.hasOwnProperty(r)&&(i=n[r])&&("function"==typeof i?s.call(this,r,i):o.call(this,r,i));return this},r.removeEvent=function(e){var n,t=typeof e,r=this._getEvents();if("string"===t)delete r[e];else if(e instanceof RegExp)for(n in r)r.hasOwnProperty(n)&&e.test(n)&&delete r[n];else delete this._events;return this},r.removeAllListeners=o("removeEvent"),r.emitEvent=function(e,n){var t,r,i,s,o=this.getListenersAsObject(e);for(s in o)if(o.hasOwnProperty(s))for(t=o[s].slice(0),i=0;i<t.length;i++)!0===(r=t[i]).once&&this.removeListener(e,r.listener),r.listener.apply(this,n||[])===this._getOnceReturnValue()&&this.removeListener(e,r.listener);return this},r.trigger=o("emitEvent"),r.emit=function(e){var n=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,n)},r.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},r._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},r._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return e.EventEmitter=i,t},n.exports?n.exports=t:e.EventEmitter=t}("undefined"!=typeof window?window:e||{})})),t=(n.named,{vend:{channelVend:{success:!0},optimalVend:{success:!0},randomVend:{success:!0}}});const r=new n;-1==navigator.userAgent.indexOf("Chrome")&&console.error("It is highly recommended that you develop vendOS in Chrome v.77+.");const i=new WebSocket("ws://fieldcommand:3000");let s=!1;i.onmessage=e=>{const n=JSON.parse(e.data);"machine"==n.type&&null==n.id?r.emit("machineEvent",n):r.emit(`message.${n.id}`,n)},i.onerror=e=>{s=!0,console.log("%cPlease ignore the above WebSocket error - Its happening because you are running vendOS locally, no error will occur in production! \nAs vendOS is running in development mode, all promises resolve with a success after 5 seconds. \nHave fun making some cool apps! ðŸ¤™","padding: 10px 0; color:#00c76b; font-size:15px"),console.log(s)};const o=e=>new Promise(n=>setTimeout(n,e));let c=0;class a extends n{constructor(){super(),this.machineEvents()}machineEvents(){r.on("machineEvent",e=>{this.emit("event",e)})}async send(e){if(s)return c++,e.id=c,await o(5e3),t[e.type][e.action];if(i.readyState===WebSocket.OPEN){return c++,e.id=c,i.send(JSON.stringify(e)),await this.receive(e.id)}return await o(500),this.send(e)}receive(e){return new Promise(n=>r.once(`message.${e}`,n))}}class u extends a{constructor(){super()}async vend(e,n){try{const t=await this.send({type:"machine",action:e,...n});if(t.ok)return t;throw t}catch(e){throw e}}channels(){return this.send({type:"machine",action:"channels"})}status(){return this.send({type:"machine",action:"status"})}randomVend(e){return this.vend("randomVend",e)}channelVend(e){return this.vend("channelVend",e)}optimalVend(e){return this.vend("optimalVend",e)}}return class{constructor(){this.Machine=new u}}}));